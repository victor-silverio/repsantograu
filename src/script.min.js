document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mobile-menu-btn"),t=document.getElementById("mobile-menu");if(e&&t){e.addEventListener("click",()=>{const s="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",!s),t.classList.toggle("hidden")});t.querySelectorAll("a").forEach(s=>{s.addEventListener("click",()=>{t.classList.add("hidden"),e.setAttribute("aria-expanded","false")})})}const s=document.querySelectorAll(".reveal");if(s.length>0){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("active"),e.unobserve(t.target))})},{threshold:.2,root:null,rootMargin:"0px 0px -50px 0px"});s.forEach(t=>e.observe(t))}(()=>{const e=document.getElementById("timeline-carousel"),t=document.getElementById("scroll-left"),s=document.getElementById("scroll-right");if(e){const o=e.querySelectorAll(".snap-center");let n=!1;const r=()=>{t&&s&&(n||(window.requestAnimationFrame(()=>{const o=e.scrollLeft,r=e.scrollWidth-e.clientWidth-20;t.style.opacity=o>20?"1":"0",s.style.opacity=o<r?"1":"0",n=!1}),n=!0))};e.addEventListener("scroll",r),window.addEventListener("resize",r),r(),t&&s&&(t.addEventListener("click",()=>{const t=o[0].offsetWidth+24;e.scrollBy({left:-t,behavior:"smooth"})}),s.addEventListener("click",()=>{const t=o[0].offsetWidth+24;e.scrollBy({left:t,behavior:"smooth"})}));let a,i,c=!1;e.querySelectorAll("img").forEach(e=>e.setAttribute("draggable","false")),e.addEventListener("pointerdown",t=>{"mouse"===t.pointerType&&(c=!0,t.preventDefault(),e.setPointerCapture(t.pointerId),e.classList.add("cursor-grabbing"),e.classList.remove("cursor-grab","snap-x","snap-mandatory","scroll-smooth"),a=t.pageX-e.offsetLeft,i=e.scrollLeft)});const l=t=>{if(!c)return;if("mouse"!==t.pointerType)return;c=!1,e.releasePointerCapture(t.pointerId),e.classList.remove("cursor-grabbing");const s=e.scrollLeft+e.clientWidth/2;let n=null,r=1/0;o.forEach(e=>{const t=e.offsetLeft+e.offsetWidth/2,o=Math.abs(s-t);o<r&&(r=o,n=e)}),n&&n.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),setTimeout(()=>{e.classList.add("cursor-grab","snap-x","snap-mandatory","scroll-smooth")},600)};let d;e.addEventListener("pointerleave",l),e.addEventListener("pointerup",l),e.addEventListener("pointercancel",l),e.addEventListener("pointermove",t=>{if(!c)return;if("mouse"!==t.pointerType)return;t.preventDefault();const s=1.5*(t.pageX-e.offsetLeft-a);e.scrollLeft=i-s}),e.addEventListener("touchstart",t=>{c=!0,e.classList.add("cursor-grabbing"),e.classList.remove("cursor-grab","snap-x","snap-mandatory","scroll-smooth"),a=t.touches[0].pageX-e.offsetLeft,i=e.scrollLeft},{passive:!0}),e.addEventListener("touchend",()=>{c=!1,e.classList.remove("cursor-grabbing"),e.classList.add("cursor-grab","snap-x","snap-mandatory","scroll-smooth")}),e.addEventListener("touchmove",t=>{c&&(d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{const s=2*(t.touches[0].pageX-e.offsetLeft-a);e.scrollLeft=i-s}))},{passive:!0})}})();const o=document.getElementById("back-to-top");if(o&&(window.addEventListener("scroll",()=>{window.scrollY>500?(o.classList.remove("opacity-0"),o.classList.add("opacity-100"),o.style.pointerEvents="auto"):(o.classList.remove("opacity-100"),o.classList.add("opacity-0"),o.style.pointerEvents="none")}),o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})),"serviceWorker"in navigator){const e=async(t=0)=>{try{const e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registrado com sucesso:",e.scope);try{await e.update()}catch(e){console.log("Falha ao atualizar SW:",e)}}catch(s){console.warn(`Falha ao registrar Service Worker (tentativa ${t+1}):`,s),t<2?(console.log("Tentando novamente em 2 segundos..."),setTimeout(()=>e(t+1),2e3)):console.error("Falha crítica no registro do Service Worker após múltiplas tentativas. O site pode não funcionar offline.")}};window.addEventListener("load",()=>{const t=()=>{setTimeout(()=>{e()},2e3)};"requestIdleCallback"in window?requestIdleCallback(t):t()})}const n=document.getElementById("lightbox"),r=document.getElementById("lightbox-img"),a=document.getElementById("lightbox-caption"),i=document.getElementById("lightbox-close"),c=document.getElementById("lightbox-prev"),l=document.getElementById("lightbox-next"),d=document.querySelectorAll(".gallery-img");if(n&&d.length>0){let e=0;const t=Array.from(d),s=s=>{e=s;const o=t[e];r.src=o.getAttribute("data-full")||o.src,a.textContent=o.getAttribute("alt")||"",n.classList.remove("hidden"),setTimeout(()=>{n.classList.remove("opacity-0")},10),document.body.style.overflow="hidden"},o=()=>{n.classList.add("opacity-0"),setTimeout(()=>{n.classList.add("hidden"),r.src="",m=!1,r.classList.add("max-h-[85vh]","cursor-zoom-in"),r.classList.remove("max-h-none","cursor-zoom-out"),n.classList.remove("overflow-auto")},300),document.body.style.overflow=""};let m=!1;r.classList.add("cursor-zoom-in"),r.classList.remove("object-contain"),r.classList.add("object-scale-down");const u=e=>{e.stopPropagation(),m=!m,m?(r.classList.remove("max-h-[85vh]","cursor-zoom-in"),r.classList.add("max-h-none","cursor-zoom-out"),n.classList.add("overflow-auto"),n.classList.remove("items-center"),n.classList.add("items-start")):(r.classList.add("max-h-[85vh]","cursor-zoom-in"),r.classList.remove("max-h-none","cursor-zoom-out"),n.classList.remove("overflow-auto"),n.classList.add("items-center"),n.classList.remove("items-start"))};r.addEventListener("click",u);const v=()=>{e=(e+1)%t.length,s(e)},L=()=>{e=(e-1+t.length)%t.length,s(e)};t.forEach((e,t)=>{e.addEventListener("click",()=>s(t))}),i.addEventListener("click",o),n.addEventListener("click",e=>{e.target===n&&o()}),l?.addEventListener("click",e=>{e.stopPropagation(),v()}),c?.addEventListener("click",e=>{e.stopPropagation(),L()}),document.addEventListener("keydown",e=>{n.classList.contains("hidden")||("Escape"===e.key&&o(),"ArrowRight"===e.key&&v(),"ArrowLeft"===e.key&&L())});let g=0,h=0;n.addEventListener("touchstart",e=>{g=e.changedTouches[0].screenX},{passive:!0}),n.addEventListener("touchend",e=>{h=e.changedTouches[0].screenX,p()},{passive:!0});const p=()=>{h<g-50&&v(),h>g+50&&L()}}});