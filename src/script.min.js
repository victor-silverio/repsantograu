document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mobile-menu-btn"),t=document.getElementById("mobile-menu");if(e&&t){e.addEventListener("click",()=>{const o="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",!o),t.classList.toggle("hidden")});t.querySelectorAll("a").forEach(o=>{o.addEventListener("click",()=>{t.classList.add("hidden"),e.setAttribute("aria-expanded","false")})})}const o=document.querySelectorAll(".reveal");if(o.length>0){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("active"),e.unobserve(t.target))})},{threshold:.2,root:null,rootMargin:"0px 0px -50px 0px"});o.forEach(t=>e.observe(t))}(()=>{const e=document.getElementById("timeline-carousel"),t=document.getElementById("scroll-left"),o=document.getElementById("scroll-right");if(e){const n=e.querySelectorAll(".snap-center");let s=!1;const r=()=>{t&&o&&(s||(window.requestAnimationFrame(()=>{const n=e.scrollLeft,r=e.scrollWidth-e.clientWidth-20;t.style.opacity=n>20?"1":"0",o.style.opacity=n<r?"1":"0",s=!1}),s=!0))};e.addEventListener("scroll",r),window.addEventListener("resize",r),r(),t&&o&&(t.addEventListener("click",()=>{const t=n[0].offsetWidth+24;e.scrollBy({left:-t,behavior:"smooth"})}),o.addEventListener("click",()=>{const t=n[0].offsetWidth+24;e.scrollBy({left:t,behavior:"smooth"})}));let a,i,c=!1;e.querySelectorAll("img").forEach(e=>e.setAttribute("draggable","false")),e.addEventListener("pointerdown",t=>{"mouse"===t.pointerType&&(c=!0,t.preventDefault(),e.setPointerCapture(t.pointerId),e.classList.add("cursor-grabbing"),e.classList.remove("cursor-grab","snap-x","snap-mandatory","scroll-smooth"),a=t.pageX-e.offsetLeft,i=e.scrollLeft)});const l=t=>{if(!c)return;if("mouse"!==t.pointerType)return;c=!1,e.releasePointerCapture(t.pointerId),e.classList.remove("cursor-grabbing");const o=e.scrollLeft+e.clientWidth/2;let s=null,r=1/0;n.forEach(e=>{const t=e.offsetLeft+e.offsetWidth/2,n=Math.abs(o-t);n<r&&(r=n,s=e)}),s&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),setTimeout(()=>{e.classList.add("cursor-grab","snap-x","snap-mandatory","scroll-smooth")},600)};let d;e.addEventListener("pointerleave",l),e.addEventListener("pointerup",l),e.addEventListener("pointercancel",l),e.addEventListener("pointermove",t=>{if(!c)return;if("mouse"!==t.pointerType)return;t.preventDefault();const o=1.5*(t.pageX-e.offsetLeft-a);e.scrollLeft=i-o}),e.addEventListener("touchend",()=>{c=!1,e.classList.remove("cursor-grabbing"),e.classList.add("cursor-grab","snap-x","snap-mandatory","scroll-smooth")}),e.addEventListener("touchmove",t=>{c&&(d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{const o=2*(t.touches[0].pageX-e.offsetLeft-a);e.scrollLeft=i-o}))},{passive:!0})}})();const n=document.getElementById("back-to-top");if(n&&(window.addEventListener("scroll",()=>{window.scrollY>500?(n.classList.remove("opacity-0"),n.classList.add("opacity-100"),n.style.pointerEvents="auto"):(n.classList.remove("opacity-100"),n.classList.add("opacity-0"),n.style.pointerEvents="none")}),n.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})),"serviceWorker"in navigator){const e=async(t=0)=>{try{const e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registrado com sucesso:",e.scope);try{await e.update()}catch(e){console.log("Falha ao atualizar SW:",e)}}catch(o){console.warn(`Falha ao registrar Service Worker (tentativa ${t+1}):`,o),t<2?(console.log("Tentando novamente em 2 segundos..."),setTimeout(()=>e(t+1),2e3)):console.error("Falha crítica no registro do Service Worker após múltiplas tentativas. O site pode não funcionar offline.")}};window.addEventListener("load",()=>{const t=()=>{setTimeout(()=>{e()},2e3)};"requestIdleCallback"in window?requestIdleCallback(t):t()})}const s=document.getElementById("lightbox"),r=document.getElementById("lightbox-img"),a=document.getElementById("lightbox-caption"),i=document.getElementById("lightbox-close"),c=document.getElementById("lightbox-prev"),l=document.getElementById("lightbox-next"),d=document.querySelectorAll(".gallery-img");if(s&&d.length>0){let e=0;const t=Array.from(d),o=o=>{e=o;const n=t[e];r.src=n.getAttribute("data-full")||n.src,a.textContent=n.getAttribute("alt")||"",s.classList.remove("hidden"),setTimeout(()=>{s.classList.remove("opacity-0")},10),document.body.style.overflow="hidden"},n=()=>{s.classList.add("opacity-0"),setTimeout(()=>{s.classList.add("hidden"),r.src=""},300),document.body.style.overflow=""},u=()=>{e=(e+1)%t.length,o(e)},m=()=>{e=(e-1+t.length)%t.length,o(e)};t.forEach((e,t)=>{e.addEventListener("click",()=>o(t))}),i.addEventListener("click",n),s.addEventListener("click",e=>{e.target===s&&n()}),l?.addEventListener("click",e=>{e.stopPropagation(),u()}),c?.addEventListener("click",e=>{e.stopPropagation(),m()}),document.addEventListener("keydown",e=>{s.classList.contains("hidden")||("Escape"===e.key&&n(),"ArrowRight"===e.key&&u(),"ArrowLeft"===e.key&&m())});let g=0,v=0;s.addEventListener("touchstart",e=>{g=e.changedTouches[0].screenX},{passive:!0}),s.addEventListener("touchend",e=>{v=e.changedTouches[0].screenX,p()},{passive:!0});const p=()=>{v<g-50&&u(),v>g+50&&m()}}});