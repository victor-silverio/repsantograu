document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mobile-menu-btn"),t=document.getElementById("mobile-menu");if(e&&t){e.addEventListener("click",()=>{const o="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",!o),t.classList.toggle("hidden")});t.querySelectorAll("a").forEach(o=>{o.addEventListener("click",()=>{t.classList.add("hidden"),e.setAttribute("aria-expanded","false")})})}const o=document.querySelectorAll(".reveal");if(o.length>0){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("active"),e.unobserve(t.target))})},{threshold:.15,rootMargin:"0px 0px -50px 0px"});o.forEach(t=>e.observe(t))}const n=document.getElementById("timeline-carousel"),s=document.getElementById("scroll-left"),r=document.getElementById("scroll-right");if(n){const e=n.querySelectorAll(".snap-center");let t=!1;const o=()=>{s&&r&&(t||(window.requestAnimationFrame(()=>{const e=n.scrollLeft,o=n.scrollWidth-n.clientWidth-20;s.style.opacity=e>20?"1":"0",r.style.opacity=e<o?"1":"0",t=!1}),t=!0))};n.addEventListener("scroll",o),window.addEventListener("resize",o),o(),s&&r&&(s.addEventListener("click",()=>{const t=e[0].offsetWidth+24;n.scrollBy({left:-t,behavior:"smooth"})}),r.addEventListener("click",()=>{const t=e[0].offsetWidth+24;n.scrollBy({left:t,behavior:"smooth"})}));let a,i,c=!1;n.querySelectorAll("img").forEach(e=>e.setAttribute("draggable","false")),n.addEventListener("pointerdown",e=>{"mouse"===e.pointerType&&(c=!0,e.preventDefault(),n.setPointerCapture(e.pointerId),n.classList.add("cursor-grabbing"),n.classList.remove("cursor-grab","snap-x","snap-mandatory","scroll-smooth"),a=e.pageX-n.offsetLeft,i=n.scrollLeft)});const l=t=>{if(!c)return;if("mouse"!==t.pointerType)return;c=!1,n.releasePointerCapture(t.pointerId),n.classList.remove("cursor-grabbing");const o=n.scrollLeft+n.clientWidth/2;let s=null,r=1/0;e.forEach(e=>{const t=e.offsetLeft+e.offsetWidth/2,n=Math.abs(o-t);n<r&&(r=n,s=e)}),s&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),setTimeout(()=>{n.classList.add("cursor-grab","snap-x","snap-mandatory","scroll-smooth")},600)};let d;n.addEventListener("pointerleave",l),n.addEventListener("pointerup",l),n.addEventListener("pointercancel",l),n.addEventListener("pointermove",e=>{if(!c)return;if("mouse"!==e.pointerType)return;e.preventDefault();const t=1.5*(e.pageX-n.offsetLeft-a);n.scrollLeft=i-t}),n.addEventListener("touchend",()=>{c=!1,n.classList.remove("cursor-grabbing"),n.classList.add("cursor-grab","snap-x","snap-mandatory","scroll-smooth")}),n.addEventListener("touchmove",e=>{c&&(d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{const t=2*(e.touches[0].pageX-n.offsetLeft-a);n.scrollLeft=i-t}))},{passive:!0})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registrado com sucesso:",e.scope),e.update().catch(e=>console.log("Falha ao atualizar SW:",e))}).catch(e=>{console.log("Falha ao registrar Service Worker:",e)})});const a=document.getElementById("lightbox"),i=document.getElementById("lightbox-img"),c=document.getElementById("lightbox-caption"),l=document.getElementById("lightbox-close"),d=document.getElementById("lightbox-prev"),u=document.getElementById("lightbox-next"),m=document.querySelectorAll(".gallery-img");if(a&&m.length>0){let e=0;const t=Array.from(m),o=o=>{e=o;const n=t[e];i.src=n.getAttribute("data-full")||n.src,c.textContent=n.getAttribute("alt")||"",a.classList.remove("hidden"),setTimeout(()=>{a.classList.remove("opacity-0")},10),document.body.style.overflow="hidden"},n=()=>{a.classList.add("opacity-0"),setTimeout(()=>{a.classList.add("hidden"),i.src=""},300),document.body.style.overflow=""},s=()=>{e=(e+1)%t.length,o(e)},r=()=>{e=(e-1+t.length)%t.length,o(e)};t.forEach((e,t)=>{e.addEventListener("click",()=>o(t))}),l.addEventListener("click",n),a.addEventListener("click",e=>{e.target===a&&n()}),u?.addEventListener("click",e=>{e.stopPropagation(),s()}),d?.addEventListener("click",e=>{e.stopPropagation(),r()}),document.addEventListener("keydown",e=>{a.classList.contains("hidden")||("Escape"===e.key&&n(),"ArrowRight"===e.key&&s(),"ArrowLeft"===e.key&&r())});let g=0,h=0;a.addEventListener("touchstart",e=>{g=e.changedTouches[0].screenX},{passive:!0}),a.addEventListener("touchend",e=>{h=e.changedTouches[0].screenX,v()},{passive:!0});const v=()=>{h<g-50&&s(),h>g+50&&r()}}});